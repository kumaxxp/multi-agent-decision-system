# 拡張多エージェント対話システム 使用ガイド

## 🚀 新機能

元の`main_direct.py`をベースに、以下の機能を拡張しました：

### ✨ 継続対話機能
- **複数ラウンドの議論**: 1つのトピックを何度も深掘り
- **対話履歴の継承**: 前のラウンドの内容を記憶して発展
- **動的な議論終了**: 判定役が適切なタイミングで終了を決定

### 🛠️ MCPツール統合
- **Context7**: 最新ライブラリドキュメント検索
- **Gemini CLI**: 大規模データ分析
- **IDE統合**: コード実行と診断

### 📊 高度な対話管理
- **対話履歴管理**: 全ラウンドの履歴を保存・参照
- **ツール使用提案**: 文脈に応じたツール提案
- **エージェント役割進化**: より専門的で戦略的な役割

## 📁 ファイル構成

```
multi-agent-decision-system/
├── main_direct.py           # オリジナル版（シンプル）
├── main_extended.py         # 拡張版（継続対話+MCP）
├── mcp_integration.py       # MCPツール統合モジュール
├── test_extended.py         # 拡張版テストスクリプト
├── EXTENDED_USAGE.md        # この使用ガイド
└── conversation_logs/       # 対話ログ（拡張形式）
```

## 🎯 使用方法

### 基本実行（拡張版）

```bash
python main_extended.py "議論したいトピック"
```

### 継続対話の例

```bash
python main_extended.py "FastAPIとDjangoの比較"

# 出力例:
# ラウンド 1: 基本的な比較
# ラウンド 2: 具体的な使用例
# ラウンド 3: 最適な選択指針
# ...最大5ラウンドまで継続
```

### テスト実行

```bash
python test_extended.py
```

## 🤖 エージェントの進化

### 語り手エージェント (creative_storyteller)
- **旧版**: 創造的な意見提示
- **新版**: + 前回議論の発展、ツール使用提案、深掘り質問

### 相槌役エージェント (careful_verifier)  
- **旧版**: 慎重な事実確認
- **新版**: + 議論の流れ整理、ツール活用、次ステップ提案

### 判定役エージェント (strategic_coordinator)
- **旧版**: 結論と代替案提示
- **新版**: + 戦略的統合、継続判断、包括的方向性決定

## 🛠️ MCPツール活用例

### Context7でライブラリ検索

```
ユーザー: "FastAPIライブラリについて調べてください"

語り手: "FastAPIの最新機能を調べてみましょう"
→ Context7が自動実行され、最新ドキュメント情報を取得
```

### Geminiで詳細分析

```
相槌役: "この提案について詳細に分析する必要があります"
→ Geminiが自動実行され、深い分析結果を提供
```

### IDE統合でコード実行

```
判定役: "実装例のコードを実行して確認しましょう"
→ IDE統合が自動実行され、コード実行結果を表示
```

## 📊 継続対話の流れ

```
ラウンド 1: 初期トピック議論
├── 語り手: 大胆な意見 + ツール提案
├── 相槌役: 検証 + 追加分析
└── 判定役: 統合 + "次のラウンドに進みます"

ラウンド 2: 発展的議論
├── 語り手: 前回を基に新視点 + さらなる調査
├── 相槌役: より詳細な検証 + 実証
└── 判定役: より包括的な統合 + 継続判断

...最大5ラウンドまたは終了まで
```

## 🎮 インタラクティブ操作

各ラウンド後に選択できます：

- **Enter**: そのまま継続
- **q**: 対話終了
- **その他テキスト**: 新たな視点を追加して継続

```
--- ラウンド1完了 ---
続行しますか？ (Enter: 続行, 'q': 終了, その他: 追加入力): 
> セキュリティ面も考慮してください

→ 「セキュリティ面も考慮してください」を追加してラウンド2開始
```

## 📈 拡張ログ形式

```json
{
  "session_id": "20250809_102013",
  "timestamp": "2025-08-09T10:20:13",
  "total_rounds": 3,
  "conversation_history": [
    {
      "round": 1,
      "agent": "語り手",
      "content": "...",
      "timestamp": "2025-08-09T10:20:15",
      "tools_used": ["gemini-cli", "context7"]
    }
  ]
}
```

## 🔧 カスタマイズ

### 最大ラウンド数の変更

```python
# main_extended.py 内
max_rounds = 5  # 3〜10の範囲で調整
```

### MCPツールの有効/無効

```python
# mcp_integration.py 内
def _detect_mcp_tools(self):
    return {
        "context7": True,      # False で無効化
        "gemini-cli": True,    # False で無効化
        "ide": False,          # True で有効化
    }
```

## 💡 効果的な使用例

### 技術比較分析
```bash
python main_extended.py "ReactとVue.jsの2024年最新比較"
# → Context7で最新ドキュメント、Geminiで詳細分析を自動実行
```

### プロジェクト設計議論
```bash
python main_extended.py "マイクロサービスアーキテクチャの実装方針"
# → 複数ラウンドで段階的に詳細化、実装例も自動生成
```

### 学習テーマ探求
```bash
python main_extended.py "機械学習の学習ロードマップ"
# → 最新ライブラリ情報とコード例を交えた包括的議論
```

## 🔄 バージョン比較

| 機能 | main_direct.py | main_extended.py |
|------|----------------|------------------|
| 基本対話 | ✅ | ✅ |
| 継続対話 | ❌ | ✅ (最大5ラウンド) |
| MCP統合 | ❌ | ✅ (Context7, Gemini, IDE) |
| 履歴管理 | 基本 | 高度 (ラウンド別) |
| ツール提案 | ❌ | ✅ (自動提案) |
| インタラクティブ | ❌ | ✅ |

拡張版は元の`main_direct.py`の安定性を保ちつつ、より深い議論と実用的なツール活用を実現しています。